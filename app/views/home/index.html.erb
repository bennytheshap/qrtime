<h3>Home</h3>

<% if user_signed_in? %>

    <%= current_user.name %>   <br><br>

    <% if current_user.has_role?(:student) == true  %>
        <p>
          <b>Courses:</b>
          <% if !current_user.courses.empty? %>
              <%= current_user.courses.collect {|c| link_to(c.name, c)}.join(", ").html_safe%>

                  <%= form_tag(course_remove_user_path(@user)) do %>
                    <table>
                      <tr>
                        <th>Course</th>
                        <th>Remove?</th>
                      </tr>
                      <% for course in @courses do %>
                          <tr>
                            <td><%= course.name %></td>
                            <td><%= check_box_tag "courses[]", course.id %></td>
                          </tr>
                      <% end %>
                    </table>
                    <br />
                    <%= submit_tag 'Remove checked courses' %>
                <% end %>
          <% else %>
              Not enrolled on any courses yet.
          <% end %>
        </p>

        <b>Enroll in new course:</b>
        <% if current_user.courses.count < Course.count then %>
            <%= form_tag(course_add_user_path(@user)) do %>
                <%= select_tag(:course,
                               options_from_collection_for_select(@user.unenrolled_courses,
                                                                  :id, :name)) %>
                <%= submit_tag 'Enroll' %>
            <% end %>
        <% else %>
            <p><%= @user.name %> is enrolled in every course.</p>
        <% end %>

        <% StudentActivity.all(:conditions => {:user_id => current_user.id}).each do |activity|  %>
            <tr>
              <td><%= activity.course_session.course.name %></td>
              <td><%= activity.action %></td>
              <td><%= activity.date %></td>
              <td><%= activity.time %></td>
            </tr>
            <br>

        <% end %>
    <% end %>
    <br><br>

    <% if current_user.has_role?(:instructor) == true  %>
        <% Course.all(:conditions => {:instructor => current_user.id}).each do |course|  %>
            <tr>
              <td><%= course.name %></td>
              <td><%= link_to 'Show', course %></td>
              <td><%= link_to 'Edit', edit_course_path(course) %></td>
              <td><%= link_to 'Destroy', course, method: :delete, data: { confirm: 'Are you sure?' } %></td>
            </tr>
            <br>
        <% end %>
        <br>
        <%= link_to 'New Course', new_course_path %>


    <% end %>
    <br><br>

    <% if current_user.has_role?(:admin) == true %>
        <% @users.each do |user| %>
            <tr>
              <td><%= link_to user.name, user %></td>
              <td><%= user.email %></td>
              <td><%= user.created_at.to_date %></td>
              <td><%= user.roles.first.name.titleize unless user.roles.first.nil? %></td>
              <td>
                <a data-toggle="modal" href="#role-options-<%= user.id %>" class="btn btn-mini" type="button">Change role</a>
                <%= render user %>
              </td>
              <td><%= link_to("Delete user", user_path(user), :data => { :confirm => "Are you sure?" }, :method => :delete, :class => 'btn btn-mini') unless user == current_user %></td>
            </tr>
            <br>
        <% end %>
    <% end %>


<% else %>
    <%= link_to 'Login', new_user_session_path %>
    <br>
    <%= link_to 'Sign Up', new_user_registration_path %>

<% end %>